package tlsPacketDebugger

import (
	"encoding/hex"
	"github.com/tachyon-protocol/udw/udwErr"
	"github.com/tachyon-protocol/udw/udwTest"
	"testing"
)

func TestGetRecord(t *testing.T) {
	packet, err := hex.DecodeString(`160303154d0200005603035dbcf2508cd0c1766ae00a25219b33838cced27ec016d36d1524cdc9c8c15a71209d3c0000c7f726402a3d217e817a170db7258985b7a1dd1ca11ff835b91fbeadc02f00000e001000050003026832ff010001000b0013bf0013bc000dfe30820dfa30820be2a00302010202132000060f1b8eb1ce4263468342000000060f1b300d06092a864886f70d01010b050030818b310b3009060355040613025553311330110603550408130a57617368696e67746f6e3110300e060355040713075265646d6f6e64311e301c060355040a13154d6963726f736f667420436f72706f726174696f6e31153013060355040b130c4d6963726f736f6674204954311e301c060355040313154d6963726f736f667420495420544c532043412032301e170d3139303433303230343830305a170d3231303433303230343830305a3017311530130603550403130c7777772e62696e672e636f6d30820122300d06092a864886f70d01010105000382010f003082010a0282010100e12253dbd223fbc5199449c2b8dd023b0a2fe5bdf32e9968511401dc1738c80c7b3be2cab407ecdef075b93d1e8b5917bf777c91e5d0bcee042cd2a5c68adcec3fdbd625ca70295dbbded9675a211f819c79b6f34215d1ceaa86281cbddaf3379dfc99064c4797ba41845f44de0600a37154e3e6a4712618e55b1b3701c07fab87f8be2dd01bcd136d253650ed2592f86f7ecef70b58ea8bb66ca626bf62c32a710e97f803c067ee20b8a8d0af9ab7dadce3d851ad24ee99999b8d57d5b06f7dbcf75521c19dc3d8fac872708d948435fc56a1ea29bb55cebba8edb1ffefabee03bb3ed47c6f20859c5b8d5154318522240a48fa16f3f171879fa24d302745510203010001a38209c8308209c4308201f4060a2b06010401d679020402048201e4048201e001de007500ee4bbdb775ce60bae142691fabe19e66a30f7e5fb072d88300c47b897aa8fdcb0000016a700a46cc000004030046304402202201222ce63d7d55c4cb6f170e187425225eb67778b2d4563c76736afba95e6d02207216d2ab6421efccec9a6b9ccac96e701c9c8a3fc56147b717594da49881f4ab0076005581d4c2169036014aea0b9b573c53f0c0e43878702508172fa3aa1d0713d30c0000016a700a48030000040300473045022100f1e91a9cbc375f218f6a740b9a445055bd21cdb6da40ce27b728ff400221af07022048cbe3b1efe126eb03a11167493b57f7a89ead36aacd01f8a032cb9d6fc6c1cd0075005cdc4392fee6ab4544b15e9ad456e61037fbd5fa47dca17394b25ee6f6c70eca0000016a700a46e60000040300463044022026d817a2eff77045af02e0bb399ab3fe6043cedfcd11e44da3310d20fb3e585102203f0d739e4dc1da8943d05ac29b27fef1f4458abd58acaad40c9d893a701c5b070076004494652eb0eeceafc44007d8a8fe28c0dae682bed8cb31b53fd33396b5b681a80000016a700a46da000004030047304502206ab7517d1edbc70486176d766bad37757633e8ee73607a4f92cf3f451fc03334022100f85580c3fb6cd50c7123cfc7a590a133860cd374e32d735c9884253e78700692302706092b060104018237150a041a3018300a06082b06010505070302300a06082b06010505070301303e06092b06010401823715070431302f06272b060104018237150887da867583eed90182c9851b81b59e6185f4eb60815d84d2df4282e7937a02016402011d30818506082b0601050507010104793077305106082b060105050730028645687474703a2f2f7777772e6d6963726f736f66742e636f6d2f706b692f6d73636f72702f4d6963726f736f66742532304954253230544c532532304341253230322e637274302206082b060105050730018616687474703a2f2f6f6373702e6d736f6373702e636f6d301d0603551d0e041604143707b59b7c1e429244ef044e24e408b8b107d3da300b0603551d0f0404030204b03082056d0603551d110482056430820560820c7777772e62696e672e636f6d8210646963742e62696e672e636f6d2e636e82132a2e706c6174666f726d2e62696e672e636f6d820a2a2e62696e672e636f6d820862696e672e636f6d821669656f6e6c696e652e6d6963726f736f66742e636f6d82132a2e77696e646f77737365617263682e636f6d8219636e2e69656f6e6c696e652e6d6963726f736f66742e636f6d82112a2e6f726967696e2e62696e672e636f6d820d2a2e6d6d2e62696e672e6e6574820e2a2e6170692e62696e672e636f6d821865636e2e6465762e7669727475616c65617274682e6e6574820d2a2e636e2e62696e672e6e6574820d2a2e636e2e62696e672e636f6d821073736c2d6170692e62696e672e636f6d821073736c2d6170692e62696e672e6e6574820e2a2e6170692e62696e672e6e6574820e2a2e62696e67617069732e636f6d820f62696e6773616e64626f782e636f6d8216666565646261636b2e6d6963726f736f66742e636f6d821b696e736572746d656469612e62696e672e6f66666963652e6e6574820e722e6261742e62696e672e636f6d82102a2e722e6261742e62696e672e636f6d82122a2e646963742e62696e672e636f6d2e636e820f2a2e646963742e62696e672e636f6d820e2a2e73736c2e62696e672e636f6d82102a2e61707065782e62696e672e636f6d82162a2e706c6174666f726d2e636e2e62696e672e636f6d820d77702e6d2e62696e672e636f6d820c2a2e6d2e62696e672e636f6d820f676c6f62616c2e62696e672e636f6d821177696e646f77737365617263682e636f6d820e7365617263682e6d736e2e636f6d82112a2e62696e6773616e64626f782e636f6d82192a2e6170692e74696c65732e646974752e6c6976652e636f6d820f2a2e646974752e6c6976652e636f6d82182a2e74302e74696c65732e646974752e6c6976652e636f6d82182a2e74312e74696c65732e646974752e6c6976652e636f6d82182a2e74322e74696c65732e646974752e6c6976652e636f6d82182a2e74332e74696c65732e646974752e6c6976652e636f6d82152a2e74696c65732e646974752e6c6976652e636f6d820b33642e6c6976652e636f6d82136170692e7365617263682e6c6976652e636f6d8214626574612e7365617263682e6c6976652e636f6d8215636e7765622e7365617263682e6c6976652e636f6d820c6465762e6c6976652e636f6d820d646974752e6c6976652e636f6d821166617265636173742e6c6976652e636f6d820e696d6167652e6c6976652e636f6d820f696d616765732e6c6976652e636f6d82116c6f63616c2e6c6976652e636f6d2e617582146c6f63616c7365617263682e6c6976652e636f6d82146c7334642e7365617263682e6c6976652e636f6d820d6d61696c2e6c6976652e636f6d82116d6170696e6469612e6c6976652e636f6d820e6c6f63616c2e6c6976652e636f6d820d6d6170732e6c6976652e636f6d82106d6170732e6c6976652e636f6d2e6175820f6d696e6469612e6c6976652e636f6d820d6e6577732e6c6976652e636f6d821c6f726967696e2e636e7765622e7365617263682e6c6976652e636f6d8216707265766965772e6c6f63616c2e6c6976652e636f6d820f7365617263682e6c6976652e636f6d8212746573742e6d6170732e6c6976652e636f6d820e766964656f2e6c6976652e636f6d820f766964656f732e6c6976652e636f6d82157669727475616c65617274682e6c6976652e636f6d820c7761702e6c6976652e636f6d82127765626d61737465722e6c6976652e636f6d82137765626d6173746572732e6c6976652e636f6d82157777772e6c6f63616c2e6c6976652e636f6d2e617582147777772e6d6170732e6c6976652e636f6d2e61753081ac0603551d1f0481a43081a130819ea0819ba08198864b687474703a2f2f6d7363726c2e6d6963726f736f66742e636f6d2f706b692f6d73636f72702f63726c2f4d6963726f736f66742532304954253230544c532532304341253230322e63726c8649687474703a2f2f63726c2e6d6963726f736f66742e636f6d2f706b692f6d73636f72702f63726c2f4d6963726f736f66742532304954253230544c532532304341253230322e63726c304d0603551d2004463044304206092b0601040182372a013035303306082b060105050702011627687474703a2f2f7777772e6d6963726f736f66742e636f6d2f706b692f6d73636f72702f637073301f0603551d23041830168014919e3b446c3d579c42772a34d74fd1cc4a972cda301d0603551d250416301406082b0601050507030206082b06010505070301300d06092a864886f70d01010b050003820201000d6034917992ce50ae0d3fa9e39741b70edd20acf872932b154bf1075a4cbdece60b26590cdc60d4baef50e6378944a1bda059664ac8a03341b8c339c7fd9ddc57e3e8be3da0b0e4adee38d6cc3b09ee382c11bc3cbc604a026f73b32855f8b23ce1d4754bfe58ca1d43d3fbd6a9fd2a58b1eacdc62c626ea1762d9631fbd870af56dcc7d196ae0dc2a0550581266a450d787a22bde2233993324b2b29ca3e17b3f943b04b95517afd66c61e670fd8413f35c71ea23d98d5aefe5cabeca3d432282241f28a66ea95e96de2d47dc1a098b5b8390bdd2268d45dfd5cddc0c864806564bd44d9f9273110406889463af3fcf135bd38350656ec3dd29ae2019919d18159c8f679765cf866cba53cb7a9696626b127d8a18b7a89b29dd95fb513c5ac1507ff9322a3939e49ac2395a701576e5f29aa19d413dcde2f8718a77972d75d0b2ea426c81d303db6d731af7ffd2e5b6e59226cc3787eca90e7066f3c962700730e0adad113fea9180adda60f49623cd4e2e59c727654e8b1fd453adcd08ad9f3bf511cc4f0ac681eb811197084e76be21efea4b0bed05d67a56c4454ec6129719535b2e3e10e8867e02adfac26028e96b962ce9c8bb46b7a7f364ac5c905f36b826d94e25c567f35a3fb6032eb20136dda0e3e7b6e7bc71b6cca13ce834c1d05c3d83a63b453ecf3f45538541bd0815596e0ab4c09c7988f2d4edb26ce0eb30005b8308205b43082049ca00302010202100f2c10c95b06c0937fb8d449f83e8569300d06092a864886f70d01010b0500305a310b300906035504061302494531123010060355040a130942616c74696d6f726531133011060355040b130a43796265725472757374312230200603550403131942616c74696d6f7265204379626572547275737420526f6f74301e170d3136303532303132353135375a170d3234303532303132353135375a30818b310b3009060355040613025553311330110603550408130a57617368696e67746f6e3110300e060355040713075265646d6f6e64311e301c060355040a13154d6963726f736f667420436f72706f726174696f6e31153013060355040b130c4d6963726f736f6674204954311e301c060355040313154d6963726f736f667420495420544c53204341203230820222300d06092a864886f70d01010105000382020f003082020a02820201009eaa15c11ba1635fe65118c516bb11dc0b4d9b910aba40492bdcd6060bc577592c3442450b4ea8c916f028f31f9695bf1ed39fcc87819621a4e7b33066ad7c6e0012afbd2c3d45aea03f75ec752005fc4162817ccc0ed921ee7300738315ba092fb160fdaa606d0b3f1a26593428b44244145b3c349d3526552350d26cfaa42bbde43bf558cb0b1b23c67dd37dcc3dd0fd0103c89ebde50823448c580350d413ee78b62da4eabd3270a150624c96c19db91c3d61da462dde8bd6f39bc5eb2eed8d3a9411c2db80a50207cd7ff79e6174b2ec6c577a7fda363e453cc6e39cdd4f9b51e76fbfa49bb6f1a304465e1721fcfc269087396c28c1f4f8e3ce16ffdb32a70b6ab3f0d55d6c395d5b9785bdbe2db6efc9e26e5cc86c41edee737cf3ca7828d230a8271768685bb52e2d8e7dcd288eafd5dd97472c48bc22438e0a19d3dcc5dfd3f2a1ef76b1246291987bc67b38b50110f010ace28e4d052c7c53112c832ccd4ac9161845aab088edfbbf80d6c9030d9bfa936a3c5421cd6d32c5292eddef6c0c23812ba7356c04889cc5a1b67b3b8c041baa4e1c48889f86f737e83fd9718a6ffdaef240c5b8779ee8c0d5525f90e613248a23100602c51dd08c4a0675aa4998195ef7b01fa84067c2826cbb6c1abfc87dbfea680cbe21e9d473454c58d431f2a5c1655c6a07bbf44442014bab620ddf4fc08502cdf743e3f534f645010203010001a38201423082013e301d0603551d0e04160414919e3b446c3d579c42772a34d74fd1cc4a972cda301f0603551d23041830168014e59d5930824758ccacfa085436867b3ab5044df030120603551d130101ff040830060101ff020100300e0603551d0f0101ff04040302018630270603551d250420301e06082b0601050507030106082b0601050507030206082b06010505070309303406082b0601050507010104283026302406082b060105050730018618687474703a2f2f6f6373702e64696769636572742e636f6d303a0603551d1f04333031302fa02da02b8629687474703a2f2f63726c332e64696769636572742e636f6d2f4f6d6e69726f6f74323032352e63726c303d0603551d200436303430320604551d2000302a302806082b06010505070201161c68747470733a2f2f7777772e64696769636572742e636f6d2f435053300d06092a864886f70d01010b050003820101006c7fea6a6fcf6b5bc134acffdc0ee07d8b1317e02f4e590ec403b9f405296547ae199ae854f664d5d8bd06e07122197bce9add798bdf70274868dbf76f3319b565eb9f9007ccb847397d0f5113910d80d476502b8507606d6d599a294016c6c70de06a574b8009bfefc74b4557b394aed7d2740c0f0183e968f1e90297876ad86d66d56b02bc5048a0b2237789de08b946a314f68c0e37963d89a50fd23242e42f2f435e3fc91ddb2a243479a207228f85485fc57e6d50f4342c3b9106ba525abd668d230c4ab56ade3349e1f8995d8f30cdcbc085c1036c68e6c75ad5c9d4589a373eae2e32070b7b4b7e7c2baddfc34c91397c1746ab7e5b296aa515554a2f0c00012803001d203dee012fd1fe8fe469714e5fa92cadc28ae453b1fd8b7d897eb523506a46c12104010100c2a6e688b73c85dbc5e3e3254276df9fafd9de9cb54d3bc669a2bfcabd9fbea0ecdb71c7770fe35e9c22c8abb9c6d3b21cf8cd1c18ccd77903ba0598707afb05402b1f65e0d4ca84ec3fa9455bed3366de37649b078e40eb71ce3057822aa53f4523f29b2048813323f531ff2e5595185a52d2165557f2e08873016d8f1e1842801620aa4f35adf771a211b95ca470c8b3ebe6983d8f0168e90c2ec46f372b49e88293f231e3426e60e11f47d5679a848362c7a581c3fb68083b046f1a4252bf550c35af4afa8b77a81016ee7a1b7c6b60c54e89983e5ea0778d2da0c3bc7120d6349d9aba5c1d8428d776edaa161937caf87a77821a7786783a0b91ec506fcf0e000000`)
	udwErr.PanicIfError(err)
	rs := GetRecordList(packet)
	udwTest.Equal(len(rs[0].ProtocolList), 4)
}

func TestGetRecord1(t *testing.T) {
	packet, err := hex.DecodeString(`16030300280000000000000000312987c4aae18aeb5f6e2e3521ac509670e28f2dfcb97fd84f4d9bb1bf69691a`)
	udwErr.PanicIfError(err)
	rs := GetRecordList(packet)
	udwTest.Equal(len(rs[0].ProtocolList), 1)
}

func TestGetRecord2(t *testing.T) {
	packet, err := hex.DecodeString(`16030300310200002d030384a797dd4c10b63d2485491646ff11473f8c6436f8bcb6bbd58b3b4a0f05281900c02b000005ff01000100160303015e0b00015a000157000154308201503081f6a003020102020101300a06082a8648ce3d040302301431123010060355040a130946616b6520436572743022180f31393139313132373035323832325a180f32313139313030393035323832325a301431123010060355040a130946616b6520436572743059301306072a8648ce3d020106082a8648ce3d030107034200040311ff88176ce903ce387af56a21022ee2dd4d30cf8c294ef070ddf36e0e03d88d9a7b46dc627159642a6ae2767a0d42da531c37640e8463f98a8a35eb4aee34a3353033300e0603551d0f0101ff0404030205a030130603551d25040c300a06082b06010505070301300c0603551d130101ff04023000300a06082a8648ce3d0403020349003046022100a467b54a2b47a0344f8d7c2311c2ae10c5b8b31e7fff0ba6e4fe460a01507c36022100a217b5517ec27d71671468f41685026ab553cadede9641f0157908f476872a6516030300740c00007003001d20a6c3830a81a82fab8b092d3ace0ddce8712f0bfc46a69423b3a3bc76ae02f72b040300483046022100b97f4c27f5f367608b13bf7412a429e8c8652576532e3726ba19291da66b46b6022100c37e35938811489c78aebde5fd081aa58fb9883b6c1a0165fead68f355bbb96116030300040e000000`)
	udwErr.PanicIfError(err)
	rs := GetRecordList(packet)
	udwTest.Equal(len(rs), 4)
}
